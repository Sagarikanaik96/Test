[
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Purchase Order",
  "modified": "2020-09-28 13:23:25.915946",
  "name": "Purchase Order-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Purchase Order', {\nrefresh: function(frm) {\n    $.each(frm.doc.items, function(idx, item){\n    console.log('AAAA')\n        frappe.call({\n\t\t\t\tmethod: \"frappe.client.get_value\",\n\t\t\t\tasync:false,\n\t\t\t\targs: {\n\t\t\t\t\tdoctype: \"Item\",\n\t\t\t\t\tfieldname:\"item_group\",\n\t\t\t\t\tfilters:{\n\t\t\t\t\t\t\"item_code\":item.item_code\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\t    frappe.db.get_value(\"Item Group\",r.message.item_group,\"parent\",(c)=>{\n                    if(r.message.item_group =='Services' || c.parent == 'Services') {\n                        $(\"[data-doctype='Purchase Receipt']\").hide();\n                    } \n                    else{\n                        $(\"[data-doctype='Purchase Receipt']\").show();\n                    }\n\t\t\t    });\n\t\t\t}\n        });\n    });\n\t}\n});\n"
 },
 {
  "docstatus": 0,
  "doctype": "Custom Script",
  "dt": "Company",
  "modified": "2020-09-28 18:59:12.138788",
  "name": "Company-Client",
  "parent": null,
  "parentfield": null,
  "parenttype": null,
  "script": "frappe.ui.form.on('Company', {\nrefresh:function(frm,cdt,cdn){\n        if(frm.doc.company_type==\"Customer\"){\n            frm.set_query(\"associate_agent_company\",function(){\n                return{\n                    filters: {\n                        \"company_type\":'Agent'\n                    }\n                }\n             });\n        }\n   \n    },\nassociate_agent_company:function(frm,cdt,cdn){\n    console.log(frappe.user_roles)\n    frappe.call({\n\t\t\tmethod: \"frappe.client.get_list\",\n\t\t\tasync:false,\n\t\t\targs: {\n\t\t\t\tdoctype: \"User Permission\",\n\t\t\t\tfields: \"user\",\n\t\t\t\tfilters:{\n\t\t\t\t\t\"for_value\":frm.doc.associate_agent_company\n\t\t\t\t}\n\t\t\t},\n\t\t\tcallback: function(r) {\n\t\t\tvar userList=[];\n\t\t\tconsole.log(r)\n\t\t\t$.each(r.message,function(idx,username){\n\t\t\t     console.log(frappe.user_roles)\n\t\t\t\tuserList.push(username.user);\n\t\t\t\t\n\t\t\t});\n\t\t\tconsole.log(userList)\n                frm.set_query(\"associate_agent\",function(){\n                    return{\n                            filters: {\n                                    \"name\":[\"in\",userList],\n                            }\n                    }\n                });\n\t}\n        \n    });\n},\nafter_save:function(frm,cdt,cdn){\n    frappe.call({\n\t\t\tmethod: \"seabridge_app.seabridge_app.doctype.request_for_quotation.request_for_quotation.create_user_permission\",\n\t\t\tasync:false,\n\t\t\targs: {\n\t\t\t\tdoctype: \"User Permission\",\n\t\t\t\tuser: frm.doc.associate_agent,\n\t\t\t\tallow:'Company',\n\t\t\t\tvalue:frm.doc.associate_agent_company,\n\t\t\t\tcheck:1\n\t\t\t}\n    });\n}\n});\n"
 }
]