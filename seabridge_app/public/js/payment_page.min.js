!function(){"use strict";
console.log("In other dashboard------------")
frappe.templates.item_dashboard='<div> <div class="dashboard-list-item">   <div class="row"><div class="col-sm-1 small" style="margin-top: 8px;"><center><input type="checkbox" id="chcb1" name="chcb1" class="chcb1"></center></div><div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;"><b>Vendor</b></div><div class="col-sm-1 small" style="margin-top: 8px;margin-left:-20px;"><b>Inv#</b></div> <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;margin-left:30px;"><b>PO$ </b> </div>  <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"><b>Inv$</b></div><div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"><b> Budget </b></div><div class="col-sm-1 small" style="margin-top: 8px;">  <b>PO Date</b>  </div><div class="col-sm-1 small" style="margin-top: 8px;"> <b> Invoice Date </b> </div><div class="col-sm-1 small" style="margin-top: 8px;"> <a data-type="match"> <b> Match ? </b></a></div><div class="col-sm-1 small" style="margin-top: 8px;">  <b>Pending With  </b></div><div class="col-sm-1 small" style="margin-top: 8px;"><b>Status</b></div>   </div></div> <div class="result"></div>  <div id="btn-more" class="more"  style="padding: 15px;"> <a class="btn btn-default btn-xs btn-more">More</a>  </div> </div>  <center><div id="records" class="records" style="font-size:90%;color:grey;"></div> <center><table><tr><td><div class="submit"><button id="btn-pay" class="btn btn-default btn-xs btn-pay  button-sbt button"  style="display:none;">Create Payment</a>    </div></td></tr></center>',frappe.templates.item_dashboard_list='<style>input{border: none;background: transparent;}.button-sbt {background-color: #008CBA;}.button-apr {background-color: #4CAF50;}.button {border: none; color: white; padding: 6px 6px;text-align: center;font-size: 10px;margin: 2px 2px;}div.b {word-wrap: break-word;}.hover{cursor: pointer;margin: 15px 0;}</style>{% for d in data %}  <div class="dashboard-list-item">   <div class="row"> <div class="col-sm-1 small" style="margin-top: 8px;"><center><input type="checkbox" id="chcb2" name="chcb2" class="btn-check"></center></div>  <div class="b">  <div class="col-sm-2 small" style="margin-top: 8px;margin-left:-20px;">     <a data-type="supplier" data-name="{{ d.supplier }}">{{ d[1] }}</a>   </div> </div>    <div class="col-sm-1 small" style="margin-top: 8px;margin-left:-20px;color:blue;">         <label  value={{d[0]}} style="color:blue;" id="inv" class="inv"> <a data-type="purchase_invoice"       data-name="{{d.name}}" href="/desk#Form/Purchase%20Invoice/{{d[0]}}"  target="_blank"><font style="color:blue;">{{d[0]}}</font></a></label></div><div class="b"> <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;margin-left:30px;" word-wrap: break-word;>  {{ d[5] }}  </div> </div>  <div class="b">  <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;"> {{ d[2]}} </div>  </div> <div class="b"> <div class="col-sm-1 small" style="margin-top: 8px;text-align:right;">  {{ d[9] }}  </div></div><div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{d[6]}}  </div> </div><div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{ d[3] }}  </div></div><div class="col-sm-1 small" style="margin-top: 8px;">  <a data-type="match">{%if d[7]==1%}Y{%else%}N{%endif%} </a> </div> <div class="b"><div class="col-sm-1 small" style="margin-top: 8px;">  {{ d[8] }}  </div></div><div class="b"><div id="btn-status" class="col-sm-1" style="margin-top: 8px;text-align:left;" name="{{d[1]}}" data-type="{{d[1]}}"> </a>         {%if (d[4]=="To Pay")%} <button  class="btn btn-default btn-xs btn-add btn-success btn-status" value="{{d[1]}}">{{d[4]}} </button>{%else%}{%if (d[4]=="Rejected")%} <button  class="btn btn-default btn-xs btn-add btn-danger" onclick="try_function()">{{d[4]}} </button>{%else%}{%if (d[4]=="Draft")%} <button  class="btn btn-default btn-xs btn-info btn-status" onclick="try_function()">{{d[4]}} </button>{%else%}<button  class="btn btn-default btn-xs btn-add btn-warning"  onclick="try_function()">{{d[4]}}</button> {%endif%} {%endif%} {%endif%}</div></div>    </div>  </div> {% endfor %}',
frappe.provide("seabridge_app"),
seabridge_app.ActionTable=Class.extend({
    init:function(e){
        $.extend(this,e),this.make()
    },
make:function(){
console.log("In Make-------------")
var e=this;
function t(t,a){
}
	this.start=0,
	this.sort_by||(this.sort_by="purchase_invoice",this.sort_order="asc"),
	this.content=$(frappe.render_template("item_dashboard")).appendTo(this.parent),this.result=this.content.find(".result"),
	this.content.on("click",".btn-move",function(){t($(this),"Move")}),
	this.content.on("click",".btn-add",function(){t($(this),"Add")}),
	this.content.on("click",".btn-pay",function(){
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var allInv = document.querySelectorAll("label[id='inv']");
		var count=0;
		for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				count++;
			}
		}
		var invoices = new Array(count);
		var j=0;
		for(var i=0; i< allInv.length; i++){
			if(allCB[i].checked==true){
				invoices[j]=allInv[i].textContent.trim();
				j++;
				console.log("Invoice------------",allInv[i].textContent)
				
			}
			
		    }
		frappe.call({method:"seabridge_app.seabridge_app.api.create_payment",
			    	    args:
			    	    {invoices:invoices,
				     account:e.account.trim(),
				     company:e.company
			    	   },
			    	    callback:function(r){
					console.log(r.message)
			    	       
			    	    }
				})
		
		//window.location.reload();

	}),
	this.content.on("click",".btn-status",function(){
		console.log("BTNSTATUS-------------")
		var vendor = jQuery(this).attr('value');
		get_paid_invoices(vendor)
	}),
	this.content.on("click",".btn-check",function(){
		var allCB = document.querySelectorAll("input[id='chcb2']");
		var checked_val=0
		for(var i=0; i< allCB.length; i++){
				if(allCB[i].checked==true){
				checked_val++;
				}
			}
		if(checked_val==0){
			document.getElementById("btn-pay").style.display="none";
		}
		else
		{
			document.getElementById("btn-pay").style.display="block";
		}
	}),

	this.content.on("click",".chcb1",function(){
		if(chcb1.checked==1){
			var allCB = document.querySelectorAll("input[id='chcb2']");
			for(var i=0; i< allCB.length; i++){
				allCB[i].checked=true
			}
		}
		else{
			var allCB = document.querySelectorAll("input[id='chcb2']");
			for(var i=0; i< allCB.length; i++){
				allCB[i].checked=false
			}
		}
	}),
	
	this.content.find(".btn-more").on("click",function(){
	    e.start+=20,e.refresh()
	
	    
	})
},
	refresh:function(){
	    this.before_refresh&&this.before_refresh();
	    var e=this;
	if(this.company!="" && this.account!=""){
	    frappe.call({method:"seabridge_app.seabridge_app.api.get_data_for_payment",
	    	    args:
	    	    {
		    name:this.purchase_invoice,
	    	    supplier:this.supplier,
		    company:this.company,
	    	    start:this.start,
	    	    sort_by:this.sort_by,
	    	    sort_order:this.sort_order},
	    	    callback:function(t){
			console.log(t.message)
	    	        e.render(t.message)	
			if(t.message.length>0){
				if(parseInt(e.start+20)>parseInt(t.message[0][11])){
					document.getElementById("records").innerHTML = "Showing "+t.message[0][11]+" of "+t.message[0][11]+" records";
					document.getElementById("btn-more").style.display="none";
				}
				else{
					document.getElementById("records").innerHTML = "Showing "+(e.start+20)+" of "+t.message[0][11]+" records";
					document.getElementById("btn-more").style.display="block";
				}
			}
			else{
				document.getElementById("btn-more").style.display="none";
				document.getElementById("records").innerHTML = "Showing 0 of 0 records";
			}	
	    	    }
	    })
		}
	},
	render:function(e){
	    0===this.start&&(this.max_count=0,this.result.empty());
	    var t=this.get_item_dashboard_data(e,this.max_count,!0);
	    if(this.max_count=this.max_count,e&&21===e.length?(this.content.find(".more").removeClass("hidden"),e.splice(-1)):1,t.data.length>0)
	    $(frappe.render_template("item_dashboard_list",t)).appendTo(this.result);
	    else{
	        var a=__("No further records available");
	        $("<span class='text-muted small'>  "+a+" </span>").appendTo(this.result)}},
	        get_item_dashboard_data:function(e,t,a){
	            t||(t=0),e||(e=[]),
	            e.forEach(function(e){
	                e.actual_or_pending=e.projected_qty+e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,
	                e.pending_qty=0,
	                e.total_reserved=e.reserved_qty+e.reserved_qty_for_production+e.reserved_qty_for_sub_contract,
	                e.actual_or_pending>e.actual_qty&&(e.pending_qty=e.actual_or_pending-e.actual_qty),
	                t=Math.max(e.actual_or_pending,e.actual_qty,e.total_reserved,t)
	                
	            });
	            var r=0;
	            return frappe.boot.user.can_write.indexOf("Stock Entry")>=0&&(r=1),{
	                data:e,max_count:t,can_write:r,show_item:a||!1}
	            
	        }
}),
	                erpnext.stock.move_item=function(e,t,a,r,n,s){
	                    var i=new frappe.ui.Dialog({title:a?__("Add Item"):__("Move Item"),
	                    fields:[{fieldname:"item_code",label:__("Item"),fieldtype:"Link",options:"Item",read_only:1},
	                    {fieldname:"source",label:__("Source Warehouse"),fieldtype:"Link",options:"Warehouse",read_only:1},
	                    {fieldname:"target",label:__("Target Warehouse"),fieldtype:"Link",options:"Warehouse",reqd:1},
	                    {fieldname:"qty",label:__("Quantity"),reqd:1,fieldtype:"Float",description:__("Available {0}",[r])},
	                    {fieldname:"rate",label:__("Rate"),fieldtype:"Currency",hidden:1}]});
	                    i.show(),i.get_field("item_code").set_input(e),t?i.get_field("source").set_input(t):(i.get_field("source").df.hidden=1,i.get_field("source").refresh()),
	                    n&&(i.get_field("rate").set_value(n),i.get_field("rate").df.hidden=0,i.get_field("rate").refresh()),
	                    a&&(i.get_field("target").df.read_only=1,i.get_field("target").value=a,
	                    i.get_field("target").refresh()),
	                    i.set_primary_action(__("Submit"),
	                    function(){
	                        var e=i   .get_values();
	                        e&&(t&&e.qty>r?frappe.msgprint(__("Quantity must be less than or equal to {0}",[r])):(e.source===e.target&&frappe.msgprint(__("Source and target warehouse must be different")),
	                        frappe.call({method:"erpnext.stock.doctype.stock_entry.stock_entry_utils.make_stock_entry",args:e,freeze:!0,
	                        callback:function(e){
	                            frappe.show_alert(__("Stock Entry {0} created",['<a href="#Form/Stock Entry/'+e.message.name+'">'+e.message.name+"</a>"])),
	                            i.hide(),s(e)}})))}),$('<p style="margin-left: 10px;"><a class="link-open text-muted small">'+__("Add more items or open full form")+"</a></p>").appendTo(i.body).find(".link-open").on("click",function(){
	                                frappe.model.with_doctype("Stock Entry",function(){
	                                    var e=frappe.model.get_new_doc("Stock Entry");
	                                    e.from_warehouse=i.get_value("source"),
					    e.to_warehouse=i.get_value("target");
	                                    var t=frappe.model.add_child(e,"items");
	                                    t.item_code=i.get_value("item_code"),
	                                    t.f_warehouse=i.get_value("target"),
	                                    t.t_warehouse=i.get_value("target"),
	                                    t.qty=i.get_value("qty"),t.conversion_factor=1,
	                                    t.transfer_qty=i.get_value("qty"),
	                                    t.basic_rate=i.get_value("rate"),
	                                    frappe.set_route("Form",e.doctype,e.name)
	                                })
	                            })
	                }}();

function get_paid_invoices(supplier){
	console.log("Supplier------------",supplier)
	console.log("In Click-------------")	
	selections=""
		 let dialogObj= new frappe.ui.form.MultiSelectDialog({
			 doctype: "Purchase Invoice",
			 target: this,
			 setters: {
			 supplier:supplier,
			 due_date:"",
			 grand_total:""
			 },
			 date_field: "transaction_date",
			 get_query() {
			 return {
				 filters: {  docstatus: ['=', 1] ,workflow_state: ['=', "Paid"]}
				 }
			 },
			 action(selections) {
			}
	})
}
//# sourceMappingURL=item-dashboard.min.js.map
